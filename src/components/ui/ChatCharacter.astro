---
/**
 * James — AFJ's animated chauffeur mascot.
 *
 * Props:
 *   size  – pixel width/height (default 64)
 *   mood  – "idle" | "talking" | "thinking" | "waving" (default "idle")
 *   id    – optional id for the wrapper (used by ChatWidget to target mood changes)
 */
interface Props {
  size?: number;
  mood?: 'idle' | 'talking' | 'thinking' | 'waving';
  id?: string;
}

const { size = 64, mood = 'idle', id } = Astro.props;
---

<div
  class="james-character inline-block"
  data-mood={mood}
  style={`width:${size}px;height:${size}px`}
  {...(id ? { id } : {})}
>
  <svg
    viewBox="0 0 120 120"
    xmlns="http://www.w3.org/2000/svg"
    width={size}
    height={size}
    aria-hidden="true"
    role="img"
  >
    <!-- Body / shoulders -->
    <g class="james-body">
      <!-- Shoulders -->
      <ellipse cx="60" cy="112" rx="42" ry="18" fill="#1B4D3E" />
      <!-- Suit jacket -->
      <rect x="30" y="88" width="60" height="26" rx="4" fill="#1B4D3E" />
      <!-- Left lapel -->
      <polygon points="42,88 56,88 48,104" fill="#15403A" />
      <!-- Right lapel -->
      <polygon points="78,88 64,88 72,104" fill="#15403A" />
      <!-- White shirt -->
      <rect x="52" y="88" width="16" height="22" fill="#FFFFFF" />
      <!-- Gold tie -->
      <polygon points="60,89 56,96 60,108 64,96" fill="#F59E0B" />
    </g>

    <!-- Neck -->
    <rect x="52" y="82" width="16" height="10" rx="3" fill="#D4A574" />

    <!-- Head -->
    <g class="james-head">
      <!-- Face -->
      <ellipse cx="60" cy="62" rx="26" ry="28" fill="#D4A574" />

      <!-- Hair visible at sides under hat -->
      <ellipse cx="36" cy="52" rx="6" ry="12" fill="#3D2B1F" />
      <ellipse cx="84" cy="52" rx="6" ry="12" fill="#3D2B1F" />

      <!-- Ears -->
      <ellipse cx="34" cy="62" rx="5" ry="7" fill="#C4956A" />
      <ellipse cx="86" cy="62" rx="5" ry="7" fill="#C4956A" />

      <!-- Eyes – white -->
      <ellipse cx="48" cy="58" rx="7" ry="6" fill="#FFFFFF" />
      <ellipse cx="72" cy="58" rx="7" ry="6" fill="#FFFFFF" />

      <!-- Pupils -->
      <g class="james-pupils">
        <circle cx="49" cy="59" r="3.5" fill="#2C1810" />
        <circle cx="73" cy="59" r="3.5" fill="#2C1810" />
        <!-- Highlights -->
        <circle cx="50.5" cy="57.5" r="1.2" fill="#FFFFFF" />
        <circle cx="74.5" cy="57.5" r="1.2" fill="#FFFFFF" />
      </g>

      <!-- Eyebrows -->
      <path d="M41 51 Q48 47 55 51" stroke="#3D2B1F" stroke-width="2" fill="none" stroke-linecap="round" />
      <path d="M65 51 Q72 47 79 51" stroke="#3D2B1F" stroke-width="2" fill="none" stroke-linecap="round" />

      <!-- Nose -->
      <path d="M58 64 Q60 68 62 64" stroke="#B8916A" stroke-width="1.5" fill="none" stroke-linecap="round" />

      <!-- Mouth – smile (idle/waving) -->
      <path class="james-mouth-smile" d="M50 73 Q60 80 70 73" stroke="#8B4513" stroke-width="2" fill="none" stroke-linecap="round" />
      <!-- Mouth – talking (animated ellipse) -->
      <ellipse class="james-mouth-talk" cx="60" cy="74" rx="6" ry="3" fill="#8B4513" style="display:none" />
      <!-- Mouth – thinking (neutral line) -->
      <line class="james-mouth-think" x1="52" y1="74" x2="68" y2="74" stroke="#8B4513" stroke-width="2" stroke-linecap="round" style="display:none" />
    </g>

    <!-- Hat -->
    <g class="james-hat">
      <!-- Hat brim -->
      <ellipse cx="60" cy="40" rx="32" ry="6" fill="#1B4D3E" />
      <!-- Hat crown -->
      <rect x="36" y="16" width="48" height="26" rx="6" fill="#1B4D3E" />
      <!-- Hat band -->
      <rect x="36" y="36" width="48" height="5" fill="#15403A" />
      <!-- AFJ badge -->
      <rect x="50" y="37" width="20" height="3.5" rx="1" fill="#F59E0B" />
      <text x="60" y="40" text-anchor="middle" font-size="3" font-weight="bold" fill="#1B4D3E" font-family="sans-serif">AFJ</text>
    </g>

    <!-- Right arm (for waving) -->
    <g class="james-arm" style="transform-origin: 88px 96px">
      <rect x="88" y="92" width="10" height="20" rx="4" fill="#1B4D3E" />
      <!-- Hand -->
      <circle cx="93" cy="92" r="5" fill="#D4A574" />
    </g>
  </svg>
</div>

<style>
  /* ===== IDLE (default) ===== */
  .james-character[data-mood="idle"] .james-mouth-smile { display: inline; }
  .james-character[data-mood="idle"] .james-mouth-talk  { display: none; }
  .james-character[data-mood="idle"] .james-mouth-think { display: none; }
  .james-character[data-mood="idle"] .james-arm { transform: none; }

  /* ===== TALKING ===== */
  .james-character[data-mood="talking"] .james-mouth-smile { display: none; }
  .james-character[data-mood="talking"] .james-mouth-talk  { display: inline; }
  .james-character[data-mood="talking"] .james-mouth-think { display: none; }

  .james-character[data-mood="talking"] .james-mouth-talk {
    animation: talk-mouth 0.35s ease-in-out infinite alternate;
  }
  .james-character[data-mood="talking"] .james-pupils {
    animation: talk-pupils 0.6s ease-in-out infinite alternate;
  }

  @keyframes talk-mouth {
    0%   { transform: scaleY(0.6); }
    100% { transform: scaleY(1.4); }
  }
  @keyframes talk-pupils {
    0%   { transform: translateY(0); }
    100% { transform: translateY(1px); }
  }

  /* ===== THINKING ===== */
  .james-character[data-mood="thinking"] .james-mouth-smile { display: none; }
  .james-character[data-mood="thinking"] .james-mouth-talk  { display: none; }
  .james-character[data-mood="thinking"] .james-mouth-think { display: inline; }

  .james-character[data-mood="thinking"] .james-pupils {
    animation: think-pupils 2s ease-in-out infinite;
  }

  @keyframes think-pupils {
    0%, 100% { transform: translateX(0); }
    25%      { transform: translateX(-3px); }
    75%      { transform: translateX(3px); }
  }

  /* ===== WAVING ===== */
  .james-character[data-mood="waving"] .james-mouth-smile { display: inline; }
  .james-character[data-mood="waving"] .james-mouth-talk  { display: none; }
  .james-character[data-mood="waving"] .james-mouth-think { display: none; }

  .james-character[data-mood="waving"] .james-arm {
    animation: wave-arm 0.4s ease-in-out 4 alternate;
  }

  @keyframes wave-arm {
    0%   { transform: rotate(0deg); }
    100% { transform: rotate(-40deg); }
  }

  /* Reduced motion */
  @media (prefers-reduced-motion: reduce) {
    .james-character .james-mouth-talk,
    .james-character .james-pupils,
    .james-character .james-arm {
      animation: none !important;
    }
  }
</style>
