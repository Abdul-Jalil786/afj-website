---
const stats = [
  {
    target: 3370,
    suffix: '+',
    label: 'People Reached Through Health Events',
    icon: '<path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/>',
  },
  {
    target: 5,
    suffix: '',
    label: 'UK Cities With Health Screenings',
    icon: '<path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/><circle cx="12" cy="10" r="3"/>',
  },
  {
    target: 2000,
    suffix: '+',
    label: 'Patients at Kenya Medical Camp',
    icon: '<path d="M22 12h-4l-3 9L9 3l-3 9H2"/>',
  },
  {
    target: 150,
    suffix: '',
    label: 'Girls Accessing STEM Education',
    icon: '<path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/>',
  },
  {
    target: 5,
    suffix: '',
    label: 'Partner Charities',
    icon: '<path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/>',
  },
  {
    target: 200,
    suffix: '+',
    label: 'SIM Cards for Digital Inclusion',
    icon: '<rect x="2" y="2" width="20" height="8" rx="2" ry="2"/><rect x="2" y="14" width="20" height="8" rx="2" ry="2"/><line x1="6" y1="6" x2="6.01" y2="6"/><line x1="6" y1="18" x2="6.01" y2="18"/>',
  },
  {
    target: 52,
    suffix: '',
    label: 'Weeks of Food Pack Distribution',
    icon: '<path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/>',
  },
  {
    target: 5,
    suffix: '',
    label: 'UN Sustainable Development Goals',
    icon: '<circle cx="12" cy="12" r="10"/><line x1="2" y1="12" x2="22" y2="12"/><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/>',
  },
];
---

<section id="impact" class="section-padding bg-afj-light-white">
  <div class="container-wide">
    <div class="text-center mb-10">
      <h2 class="text-afj-green mb-3">Our Impact at a Glance</h2>
      <p class="text-afj-secondary text-lg max-w-2xl mx-auto">A year of meaningful action across our communities</p>
    </div>
    <div class="impact-stats-grid grid grid-cols-2 md:grid-cols-4 gap-4 md:gap-6">
      {stats.map((stat) => (
        <div class="impact-stat-card bg-white rounded-xl shadow-md p-5 text-center animate-on-scroll" data-target={stat.target}>
          <div class="w-12 h-12 mx-auto mb-3 rounded-full bg-afj-accent/10 flex items-center justify-center">
            <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="#2F855A" stroke-width="1.5" aria-hidden="true">
              <Fragment set:html={stat.icon} />
            </svg>
          </div>
          <div class="text-2xl md:text-3xl font-bold text-afj-green">
            <span class="impact-number">0</span>{stat.suffix}
          </div>
          <p class="text-afj-secondary text-xs md:text-sm mt-1">{stat.label}</p>
        </div>
      ))}
    </div>
  </div>
</section>

<script is:inline>
  (function () {
    if (window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
      document.querySelectorAll('.impact-stat-card').forEach(function (card) {
        var numberEl = card.querySelector('.impact-number');
        if (numberEl) numberEl.textContent = card.getAttribute('data-target');
      });
      return;
    }

    var observer = new IntersectionObserver(function (entries) {
      entries.forEach(function (entry) {
        if (!entry.isIntersecting) return;
        var cards = entry.target.querySelectorAll('.impact-stat-card');
        cards.forEach(function (card) {
          var target = parseInt(card.getAttribute('data-target'), 10);
          var numberEl = card.querySelector('.impact-number');
          if (!numberEl || numberEl.dataset.animated) return;
          numberEl.dataset.animated = 'true';

          var duration = 2000;
          var startTime = null;

          function animate(timestamp) {
            if (!startTime) startTime = timestamp;
            var progress = Math.min((timestamp - startTime) / duration, 1);
            var eased = 1 - Math.pow(1 - progress, 3);
            numberEl.textContent = Math.floor(eased * target).toLocaleString();
            if (progress < 1) {
              requestAnimationFrame(animate);
            } else {
              numberEl.textContent = target.toLocaleString();
            }
          }
          requestAnimationFrame(animate);
        });
        observer.unobserve(entry.target);
      });
    }, { threshold: 0.2 });

    var grid = document.querySelector('.impact-stats-grid');
    if (grid) observer.observe(grid);
  })();
</script>
