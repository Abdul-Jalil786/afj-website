---
interface Props {
  title: string;
  description: string;
  canonicalURL?: string;
  ogImage?: string;
  ogType?: string;
  jsonLD?: Record<string, unknown>;
}

const {
  title,
  description,
  canonicalURL = Astro.url.href,
  ogImage = '/images/logo/afj-logo-final.webp',
  ogType = 'website',
  jsonLD,
} = Astro.props;

const siteName = 'AFJ Limited';
const gscVerification = import.meta.env.GOOGLE_SEARCH_CONSOLE_VERIFICATION;

// Global LocalBusiness schema — injected on every page so Google always
// associates organisation info with every URL on the site.
const globalOrgSchema = {
  '@context': 'https://schema.org',
  '@type': 'LocalBusiness',
  '@id': 'https://www.afjltd.co.uk/#organization',
  name: 'AFJ Limited',
  url: 'https://www.afjltd.co.uk',
  logo: 'https://www.afjltd.co.uk/images/logo/afj-logo-final.png',
  telephone: '0121 689 1000',
  email: 'info@afjltd.co.uk',
  foundingDate: '2006',
  address: [
    {
      '@type': 'PostalAddress',
      streetAddress: 'AFJ Business Center, 2-18 Forster Street, Nechells',
      addressLocality: 'Birmingham',
      addressRegion: 'West Midlands',
      postalCode: 'B7 4JD',
      addressCountry: 'GB',
    },
    {
      '@type': 'PostalAddress',
      streetAddress: 'AFJ Manchester Office',
      addressLocality: 'Manchester',
      addressRegion: 'Greater Manchester',
      postalCode: 'M35 0BR',
      addressCountry: 'GB',
    },
  ],
  geo: { '@type': 'GeoCoordinates', latitude: 52.493, longitude: -1.878 },
  openingHoursSpecification: {
    '@type': 'OpeningHoursSpecification',
    dayOfWeek: ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday'],
    opens: '08:00',
    closes: '18:00',
  },
  sameAs: [
    'https://www.facebook.com/afjtravel',
    'https://uk.linkedin.com/company/afj-ltd',
  ],
};

// Skip the global org schema on the homepage — it already has a richer
// LocalBusiness schema with hasOfferCatalog etc.
const isHomepage = Astro.url.pathname === '/' || Astro.url.pathname === '';
const pageHasLocalBusiness = jsonLD && (jsonLD as any)['@type'] === 'LocalBusiness';
const showGlobalOrg = !isHomepage && !pageHasLocalBusiness;
---

<!-- Primary Meta Tags -->
<meta name="title" content={title} />
{gscVerification && <meta name="google-site-verification" content={gscVerification} />}
<meta name="description" content={description} />
<meta name="robots" content="index, follow" />

<!-- Canonical -->
<link rel="canonical" href={canonicalURL} />

<!-- Open Graph -->
<meta property="og:type" content={ogType} />
<meta property="og:url" content={canonicalURL} />
<meta property="og:title" content={title} />
<meta property="og:description" content={description} />
<meta property="og:image" content={ogImage} />
<meta property="og:site_name" content={siteName} />
<meta property="og:locale" content="en_GB" />

<!-- Twitter Card -->
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:url" content={canonicalURL} />
<meta name="twitter:title" content={title} />
<meta name="twitter:description" content={description} />
<meta name="twitter:image" content={ogImage} />

<!-- Geo Tags -->
<meta name="geo.region" content="GB-BIR" />
<meta name="geo.placename" content="Birmingham" />

{jsonLD && (
  <script type="application/ld+json" set:html={JSON.stringify(jsonLD)} />
)}

{showGlobalOrg && (
  <script type="application/ld+json" set:html={JSON.stringify(globalOrgSchema)} />
)}
